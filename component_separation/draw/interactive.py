"""
interactive.py: script for calling draw.component_separation using jupyter

"""

__author__ = "S. Belkner"
# %% run header
import json
from matplotlib import lines
import logging
import logging.handlers
from matplotlib.patches import Patch
import os
import platform
import sys
from logging import CRITICAL, DEBUG, ERROR, INFO
from typing import Dict, List, Optional, Tuple
import matplotlib.pyplot as plt
import component_separation.spherelib.python.spherelib.astro as slhpastro

import numpy as np
import component_separation.io as io
import seaborn as sns
import component_separation.masking as msk

import healpy as hp
from astropy.io import fits
from component_separation.cs_util import Planckf, Plancks

with open('/mnt/c/Users/sebas/OneDrive/Desktop/Uni/project/component_separation/config.json', "r") as f:
    cf = json.load(f)



uname = platform.uname()
if uname.node == "DESKTOP-KMIGUPV":
    mch = "XPS"
else:
    mch = "NERSC"

PLANCKMAPFREQ = [p.value for p in list(Planckf)]
PLANCKSPECTRUM = [p.value for p in list(Plancks)]


mskset = cf['pa']['mskset'] # smica or lens
freqdset = cf['pa']['freqdset'] # DX12 or NERSC

lmax = cf['pa']["lmax"]
lmax_mask = cf['pa']["lmax_mask"]
llp1 = cf['pa']["llp1"]
bf = cf['pa']["bf"]

num_sim = cf['pa']["num_sim"]

spec_path = cf[mch]['outdir']
indir_path = cf[mch]['indir']
specfilter = cf['pa']["specfilter"]



# %%
plt.plot([0., 0., 1.0000013,0.99990068,0.9996008,0.99966753
,0.99994126,0.99999147,0.99992268,0.99991966,1.00000418,1.00004968
,1.00002977,1.00001097,1.00005033,1.00009801,1.00010418,1.00009168
,1.00010691,1.00014539,1.00016667,1.00016946,1.00018869,1.00023069
,1.00040364,1.00041502,1.00043081,1.0004631,1.00049916,1.00051892
,1.00053059,1.0005584,1.0005916,1.00061834,1.00063319,1.00065016
,1.00067512,1.00069897,1.00071164,1.00072575,1.00074805,1.00077198
,1.00078747,1.00080249,1.00081904,1.0008409,1.0008588,1.00087076
,1.00089093,1.00090618,1.00094365,1.00099135,1.00104068,1.00109838
,1.00115423,1.00121224,1.00127385,1.00133697,1.00140422,1.0014702
,1.00153947,1.00161197,1.0016852,1.00176258,1.00184422,1.00192048
,1.00200773,1.00209466,1.00218192,1.0022717,1.0023508,1.00241582
,1.00248248,1.00254865,1.00261829,1.00268908,1.00276204,1.00283288
,1.00290738,1.00298279,1.00306022,1.00314118,1.00321951,1.00329949
,1.00338463,1.00346808,1.00355312,1.0036398,1.00373024,1.0038188
,1.00391243,1.00400735,1.00410096,1.00420057,1.00429655,1.00439479
,1.00449637,1.00459711,1.00470214,1.00480523,1.00490991,1.00501626
,1.00512503,1.00523302,1.0053427,1.00545558,1.00556825,1.005682
,1.00579637,1.00591452,1.00605869,1.00623054,1.00640672,1.00658347
,1.00676348,1.00694346,1.00712634,1.00731307,1.00749838,1.00768862
,1.00787866,1.008074,1.00826706,1.00846736,1.00866669,1.00886644
,1.00907309,1.00927881,1.00948444,1.00969724,1.00985625,1.00996328
,1.01007503,1.01019101,1.01029744,1.01041427,1.01052593,1.01063959
,1.01075797,1.01087385,1.01099028,1.01111135,1.01123322,1.01135283
,1.01147585,1.01160139,1.01172144,1.01184684,1.01197427,1.01210377
,1.01227268,1.01248763,1.01271107,1.01291886,1.01314402,1.01336351
,1.01358523,1.01380255,1.01403006,1.01424885,1.01447803,1.01470384
,1.0149343,1.01517105,1.01539809,1.01562559,1.01586317,1.01609236
,1.01633976,1.0165673,1.01676836,1.01692933,1.01709238,1.017256
,1.01742428,1.0175776,1.01775178,1.01791867,1.01808475,1.01826157
,1.01843358,1.01860949,1.01877983,1.01896549,1.01914453,1.01931264
,1.01950499,1.0196953,1.01986613,1.02006092,1.02024187,1.02040103
,1.02056895,1.0207235,1.02088021,1.02104698,1.02122788,1.02140239
,1.02157231,1.02175309,1.02193447,1.02211561,1.02229721,1.02248365
,1.02266219,1.02286141,1.02304812,1.02323159,1.02341336,1.02361237
,1.02385334,1.02418173,1.02446298,1.02478046,1.02508875,1.02540582
,1.02571724,1.02604119,1.02634309,1.02665971,1.02700227,1.02731107
,1.02761746,1.02793898,1.02825922,1.02858809,1.0289231,1.02926221
,1.0295676,1.02989423,1.03008987,1.03012592,1.03017421,1.03021962
,1.03027658,1.0303304,1.03038002,1.03044154,1.03049471,1.03058628
,1.03062413,1.03070953,1.03077177,1.03084661,1.03091627,1.03099439
,1.03107832,1.0311536,1.03124249,1.03132369,1.03144883,1.03167176
,1.03186873,1.03205565,1.03228632,1.0324946,1.03270759,1.03292837
,1.03313124,1.03334761,1.03357224,1.03380073,1.03400706,1.03424282
,1.03447453,1.03471786,1.03493548,1.03516619,1.03539854,1.03564281
,1.03589734,1.03616063,1.03644958,1.03669148,1.03702077,1.03727047
,1.03757005,1.03786476,1.03813898,1.03842583,1.03869505,1.03901644
,1.03931004,1.03957778,1.03987544,1.04015265,1.04047711,1.04075763
,1.04106392,1.04136628,1.04153532,1.04163318,1.04169706,1.04179353
,1.04189075,1.04197787,1.04207647,1.04217813,1.04228009,1.04240643
,1.04250611,1.04261891,1.04274357,1.0428627,1.04301959,1.04315128
,1.04327565,1.04340889,1.04355492,1.04370555,1.04388996,1.04414254
,1.044356,1.04458295,1.04483294,1.04505598,1.04529364,1.04551943
,1.04577204,1.04602719,1.04627151,1.04650695,1.04677065,1.04702394
,1.04728619,1.04754702,1.04779938,1.04802985,1.04830663,1.04853981
,1.04884274,1.04913226,1.04944088,1.04973184,1.05002804,1.05035074
,1.05062515,1.05095591,1.05128277,1.05159131,1.05189908,1.05221073
,1.05257085,1.05291935,1.05323457,1.05350024,1.05383564,1.05418447
,1.05452828,1.05487196,1.05504425,1.05512402,1.05521213,1.05525206
,1.0553402,1.05542916,1.05550664,1.05563383,1.05571964,1.05582886
,1.05591823,1.05601969,1.05613912,1.05623872,1.05639519,1.05650297
,1.05664338,1.05677424,1.05690026,1.05702804,1.05731626,1.05783067
,1.05830237,1.05876291,1.05925571,1.0597383,1.06023913,1.06067983
,1.06117612,1.06164309,1.06214183,1.06261672,1.06309862,1.06353212
,1.06403329,1.06452734,1.06495888,1.06542698,1.06589265,1.06640205
,1.06659236,1.06654772,1.06650089,1.0664547,1.06641164,1.06639588
,1.06635473,1.06634227,1.06633946,1.06634445,1.06636049,1.06638444
,1.06636473,1.0664541,1.06650654,1.06653265,1.066554,1.06662637
,1.06670144,1.06675845,1.06690525,1.06713516,1.06734666,1.06758902
,1.06781824,1.0680508,1.06827091,1.06851051,1.06874881,1.06900078
,1.06926897,1.06952532,1.06974487,1.06999944,1.07024833,1.07052063
,1.07077701,1.07103909,1.07131702,1.07158182,1.07173644,1.07177793
,1.07180923,1.07186252,1.07191276,1.07195472,1.07204138,1.0721344
,1.07220015,1.07225896,1.07236218,1.07245997,1.07253682,1.07265652
,1.07273488,1.07285913,1.07294307,1.0730942,1.07319416,1.07330709
,1.07352282,1.07374298,1.0739939,1.07425927,1.07449651,1.07478825
,1.07506382,1.07534261,1.07564507,1.07589333,1.07618381,1.07648757
,1.07678152,1.07706603,1.07737815,1.07769665,1.07797088,1.07829474
,1.07859786,1.07891856,1.07913769,1.07928017,1.0794074,1.07952968
,1.0796703,1.07984778,1.07996748,1.08014131,1.08028144,1.08045884
,1.08061572,1.08075028,1.08093914,1.08110379,1.08128348,1.08143675
,1.08163159,1.08181058,1.08199484,1.08217908,1.08234711,1.0826017
,1.08282531,1.08308421,1.08331227,1.08353995,1.08381755,1.08404791
,1.08432269,1.08455782,1.0848081,1.08508178,1.08537117,1.0856365
,1.0859195,1.08616476,1.08645057,1.08673766,1.08701546,1.08729754
,1.0875443,1.08785478,1.08814186,1.08844198,1.08874563,1.08902189
,1.08931731,1.08963379,1.08992357,1.09022268,1.09053655,1.09084347
,1.09115343,1.09144475,1.09176939,1.09198964,1.09216951,1.0922911
,1.0924311,1.09262511,1.09278679,1.09296356,1.09314787,1.09330923
,1.09354087,1.09372168,1.0939346,1.09412283,1.09436491,1.09456995
,1.09479002,1.09503022,1.09523577,1.0955032,1.09569635,1.09596914
,1.09618638,1.09642821,1.09666814,1.09692438,1.09715485,1.0974277
,1.09769722,1.09792977,1.09820104,1.09844151,1.09871534,1.09898322
,1.09923798,1.09949248,1.09975866,1.10004768,1.10032668,1.10056565
,1.10086884,1.10115933,1.10143297,1.10171705,1.1020162,1.10231183
,1.10258566,1.10284578,1.10317181,1.10344453,1.10375545,1.10395418
,1.10412361,1.10427849,1.10446435,1.10463841,1.10486686,1.10503279
,1.10523562,1.10546578,1.10567565,1.10589252,1.10608969,1.10633121
,1.10656545,1.10680772,1.10703804,1.10730885,1.10754297,1.10777213
,1.10804979,1.10830676,1.10854552,1.10881656,1.10906583,1.10932272
,1.10960135,1.1098926,1.11015606,1.1104289,1.11069959,1.11097689
,1.11127142,1.11155073,1.11184966,1.11211594,1.11239696,1.11269072
,1.11298065,1.11329542,1.11356035,1.11388145,1.11416142,1.114467
,1.11478855,1.11508351,1.11538577,1.11568839,1.11598557,1.116298
,1.11658579,1.11687702,1.1171052,1.11734554,1.11759453,1.11784842
,1.11810345,1.11835927,1.11860115,1.11888698,1.11912411,1.11940554
,1.11967332,1.119962,1.12024256,1.12051716,1.12079084,1.121081
,1.12134932,1.12165828,1.12194258,1.12222599,1.12253704,1.12284947
,1.12314544,1.12341833,1.12373376,1.12403759,1.12433238,1.1246619
,1.12494984,1.12525711,1.12559394,1.12590253,1.12621786,1.126517
,1.1268682,1.12718108,1.12748736,1.12781369,1.12812367,1.12848425
,1.12880012,1.12913258,1.12945277,1.12979681,1.13010655,1.13046314
,1.13080036,1.13113993,1.1314793,1.13175563,1.13194382,1.1321706
,1.13241493,1.13265329,1.13288732,1.13313731,1.13340698,1.13366167
,1.13392028,1.13420262,1.1344644,1.13471988,1.13500359,1.13527374
,1.13555489,1.13584611,1.13613629,1.13642765,1.13669437,1.13699938
,1.13729382,1.1375802,1.13787715,1.13818457,1.13849963,1.1387897
,1.13909002,1.13943406,1.13970563,1.14002477,1.14033919,1.14064804
,1.14096659,1.14128868,1.14160533,1.14190585,1.14225117,1.1425601
,1.14286952,1.14319796,1.14352016,1.14385449,1.14417933,1.14453608
,1.14487102,1.14519364,1.14552419,1.14586161,1.14619549,1.14649264
,1.14675295,1.14702192,1.14727378,1.14754322,1.14781486,1.14810349
,1.14835862,1.14865474,1.14891649,1.14921824,1.14949342,1.14980433
,1.15010343,1.15041063,1.15069767,1.15102786,1.15134131,1.15161942
,1.15193193,1.15225503,1.15254093,1.1528736,1.15318681,1.15351968
,1.15382346,1.15413834,1.15446506,1.15479823,1.1551396,1.15546383
,1.15578554,1.15611646,1.15645217,1.15678788,1.15711445,1.15745427
,1.15778889,1.15813421,1.15846903,1.15881574,1.15914541,1.1594911
,1.15982773,1.1602007,1.16055001,1.16090218,1.16123461,1.16157768
,1.16194874,1.16222125,1.16248279,1.1627316,1.16296952,1.16322745
,1.16347493,1.16374694,1.16402881,1.16428367,1.16455583,1.16483455
,1.1650996,1.16539447,1.1656618,1.16595541,1.16622533,1.16650916
,1.16681038,1.16711515,1.16740164,1.16769797,1.16797612,1.16828711
,1.16857285,1.16888443,1.16915501,1.16948844,1.16978758,1.17009121
,1.1703935,1.17069339,1.17101429,1.17130303,1.17162276,1.17196232
,1.17225955,1.17254547,1.17288274,1.17321591,1.17353409,1.17385832
,1.17416559,1.17448455,1.17480409,1.17514224,1.17546578,1.17577593
,1.17612036,1.17644687,1.17676423,1.17709697,1.1774019,1.17772257
,1.17806113,1.17836675,1.17868742,1.1790196,1.179333,1.17964533
,1.17996842,1.18028582,1.18061006,1.18093085,1.18125729,1.18161402
,1.18192944,1.18223809,1.18259125,1.18291989,1.18324723,1.18357974
,1.18391505,1.18424551,1.18458257,1.18490952,1.18525124,1.18559207
,1.1859385,1.18626868,1.18662621,1.18696334,1.18730626,1.18765664
,1.18799556,1.18833017,1.18869509,1.18904806,1.18941257,1.18975022
,1.19011004,1.19046423,1.1907999,1.19118006,1.19152849,1.19189368
,1.19225493,1.19260806,1.19296417,1.1933347,1.1936906,1.19399758
,1.19424512,1.19450392,1.19478307,1.19503052,1.19530147,1.19557442
,1.1958492,1.19611252,1.19638435,1.19666729,1.19694785,1.19723827
,1.19751397,1.19781523,1.19808457,1.19838085,1.19866526,1.19897583
,1.1992688,1.19955144,1.19986929,1.20014798,1.20046805,1.20078083
,1.20108473,1.20136947,1.20169197,1.20199028,1.20230115,1.20261657
,1.20293332,1.20325541,1.20357101,1.20390653,1.2042186,1.2045446
,1.20486416,1.20519701,1.20552377,1.20584302,1.20618746,1.20650806
,1.20684111,1.20716637,1.20749599,1.20783179,1.20818136,1.20851883
,1.20885048,1.20916255,1.20946277,1.20975764,1.21004451,1.21036389
,1.21068013,1.21097516,1.21128363,1.2115929,1.21190274,1.21222701
,1.21252825,1.21285175,1.21316093,1.21349674,1.21379626,1.21414125
,1.21445007,1.21476906,1.21510973,1.21543293,1.21576508,1.21610291
,1.21642143,1.21675896,1.21710025,1.21743206,1.21777845,1.21812637
,1.21847448,1.21884395,1.21920993,1.21955469,1.21991114,1.22026125
,1.22062872,1.22099802,1.2213666,1.22173391,1.22208904,1.22245828
,1.22282293,1.22318049,1.22354077,1.22389204,1.22427965,1.2246356
,1.22500429,1.2253593,1.22572548,1.22616627,1.22664143,1.22712425
,1.22759566,1.2280714,1.22854523,1.22899843,1.22946451,1.22993039
,1.23039818,1.23083604,1.23130004,1.23175532,1.23221009,1.2326311
,1.23307673,1.23351123,1.23393414,1.23435769,1.23476327,1.2351762
,1.23557877,1.23597318,1.23639634,1.23401557,1.23435405,1.23466025
,1.23494756,1.23525608,1.23553573,1.23579203,1.23608793,1.23633955
,1.23662228,1.23690499,1.23720941,1.23749259,1.23780419,1.23809906
,1.23842646,1.23873785,1.23907497,1.2393801,1.23969404,1.24001807
,1.24033549,1.24067327,1.2409868,1.24130151,1.2416237,1.2419471
,1.24228476,1.24260542,1.24291872,1.24326069,1.24358086,1.24394388
,1.24429129,1.24463726,1.24496886,1.24529925,1.24561648,1.24595079
,1.24627733,1.24660826,1.24696276,1.2473138,1.24765665,1.24801474
,1.24838171,1.24873476,1.24909342,1.24945957,1.24980433,1.25012291
,1.25043898,1.25074596,1.25110707,1.25144715,1.25180902,1.25215626
,1.25252933,1.25288129,1.25324528,1.25360858,1.25395398,1.2542675
,1.25461115,1.25494798,1.2552754,1.25559994,1.25591785,1.25624849
,1.2565815,1.2569357,1.25726133,1.25760221,1.25792089,1.25824633
,1.25858222,1.25888884,1.25919474,1.25951682,1.25983096,1.26015666
,1.26045948,1.26075237,1.26105656,1.26132724,1.2616209,1.26192776
,1.26224351,1.26254916,1.26284858,1.26317498,1.26348748,1.26378185
,1.26407979,1.26438211,1.26467441,1.26497214,1.26525561,1.26552898
,1.26580547,1.266101,1.26637096,1.26666237,1.26694866,1.26722827
,1.26750534,1.26776705,1.26802841,1.26830307,1.26857004,1.26884141
,1.26912891,1.26940303,1.2697159,1.26998654,1.27027702,1.27055346
,1.27083977,1.27112469,1.27143154,1.27170863,1.27199741,1.27228494
,1.27257615,1.27285745,1.2731536,1.2734588,1.27374995,1.27405755
,1.27434266,1.27464718,1.27495838,1.27530259,1.27563142,1.27594893
,1.27626626,1.27658407,1.27690581,1.2772096,1.27752419,1.2778282
,1.27815271,1.2784667,1.27879271,1.27912939,1.27946975,1.27978617
,1.28009942,1.28040226,1.28072538,1.28104747,1.28137024,1.28169873
,1.28202485,1.28236806,1.28271881,1.28305101,1.2834207,1.28376775
,1.28415174,1.28450086,1.28483728,1.28518803,1.2855403,1.28588197
,1.2862382,1.28657412,1.28693246,1.28728191,1.28762671,1.28795033
,1.28827796,1.28859439,1.28889527,1.28919066,1.28949726,1.28978988
,1.29009229,1.29038501,1.29072021,1.2910253,1.29131503,1.29161616
,1.29189341,1.29218028,1.29248326,1.29278139,1.29307583,1.29339355
,1.29368229,1.2939661,1.29423514,1.29448548,1.29474113,1.29498185
,1.29526821,1.29552354,1.29583793,1.29614712,1.29646606,1.29677355
,1.29706982,1.29739423,1.29770118,1.29801005,1.29830194,1.29861225
,1.29893883,1.29922592,1.29952379,1.29979086,1.30009418,1.30036815
,1.30065957,1.30093948,1.30125619,1.30151691,1.30179646,1.30210338
,1.30239509,1.30267379,1.30296075,1.30324928,1.30356332,1.30386573
,1.3041521,1.30447097,1.30479772,1.30510904,1.30545563,1.30578513
,1.30607562,1.30641682,1.30674427,1.3070443,1.30736216,1.30763435
,1.30791549,1.30819451,1.30848012,1.30877649,1.30908183,1.30938828
,1.30971286,1.31002846,1.31033452,1.3106269,1.31090756,1.31114985
,1.31141372,1.31165419,1.31190697,1.31216516,1.31237927,1.31261356
,1.31285716,1.31308681,1.31334095,1.31356197,1.31379908,1.31404472
,1.31427631,1.31450566,1.31474566,1.3149886,1.31522811,1.31547124
,1.31571239,1.31594509,1.31616647,1.31639199,1.3166307,1.31687396
,1.31711151,1.31734705,1.31760923,1.31783017,1.31807813,1.31829585
,1.31850487,1.31870912,1.31893267,1.31913092,1.31935452,1.31957282
,1.31982132,1.32006302,1.3203011,1.32055688,1.32078743,1.32102653
,1.32125366,1.32146609,1.32168031,1.32192373,1.32216559,1.32241172
,1.32268628,1.32294772,1.32322399,1.32348414,1.32373292,1.32399913
,1.3242624,1.32452563,1.3247844,1.32505789,1.32530715,1.32556711
,1.32581996,1.32608137,1.32635362,1.32661932,1.32689124,1.32715479
,1.3274243,1.3277065,1.32799358,1.32828335,1.32858112,1.32887409
,1.32917398,1.32948122,1.32978301,1.33009311,1.33037,1.33064568
,1.33094236,1.33121683,1.3315052,1.33182125,1.33212241,1.33242403
,1.33268716,1.33298387,1.33323648,1.33349931,1.33373411,1.33399461
,1.33425327,1.33449502,1.33474466,1.33499599,1.33525635,1.33550196
,1.33570377,1.33591813,1.336122,1.33631791,1.3365144,1.33673843
,1.33696021,1.33720077,1.33743981,1.33768047,1.33791119,1.33816703
,1.33842209,1.33864835,1.33887802,1.3391187,1.33935322,1.33957743
,1.33980251,1.34001705,1.34022403,1.34045602,1.34066246,1.34085544
,1.3410453,1.34124604,1.34143905,1.34162793,1.34182851,1.34202093
,1.34222748,1.3424392,1.34262346,1.3428047,1.34300981,1.34319864
,1.34339105,1.34356977,1.3437576,1.34395151,1.344163,1.34438098
,1.34461507,1.34485402,1.34512244,1.34536665,1.34561433,1.34587469
,1.3461274,1.34638208,1.34666768,1.34697566,1.34725919,1.34753749
,1.34782675,1.34812716,1.34840402,1.34868997,1.34896526,1.34922523
,1.34949203,1.34975188,1.3499974,1.35025855,1.35055078,1.35081653
,1.35107538,1.35134631,1.35162495,1.35190552,1.35219202,1.3524746
,1.35275612,1.35306113,1.35335923,1.35368053,1.35399362,1.3543054
,1.35462473,1.35491676,1.35524023,1.35550633,1.35581846,1.35616195
,1.35648891,1.3568173,1.35714503,1.35749086,1.35783477,1.35816301
,1.358496,1.35883901,1.35917326,1.35950027,1.35981269,1.36011875
,1.36042037,1.36071754,1.36099587,1.3612903,1.36157035,1.36182257
,1.36205319,1.36230814,1.3625647,1.36281532,1.3630717,1.36332286
,1.36357152,1.36381523,1.36405744,1.36430635,1.3645657,1.36482775
,1.36508401,1.36533024,1.36558305,1.36584221,1.36610171,1.36635909
,1.3666021,1.36686335,1.36711686,1.36735804,1.36758641,1.3678106
,1.36802589,1.36823091,1.36841721,1.36862728,1.36884827,1.36904507
,1.36927056,1.36949208,1.36968132,1.36986421,1.37003135,1.37020481
,1.37037291,1.37054477,1.37071388,1.37088937,1.37104701,1.37118927
,1.37135618,1.37150906,1.37167409,1.3718406,1.37200645,1.37219744
,1.37239919,1.37259954,1.37280609,1.37304754,1.37325451,1.37346975
,1.3736897,1.37389624,1.37409183,1.37430178,1.37449506,1.37469668
,1.37491159,1.37509073,1.37527454,1.37545121,1.37562934,1.37581596
,1.37598632,1.37616964,1.37633769,1.37650822,1.37667831,1.37682117
,1.37697429,1.37713288,1.37726702,1.37741172,1.37759933,1.37775659
,1.3779263,1.37807586,1.37822856,1.37836548,1.37850742,1.37866517
,1.37881204,1.37898403,1.3791653,1.37932464,1.3794908,1.37965527
,1.37982413,1.37999149,1.38016921,1.38032829,1.38048401,1.38066274
,1.38082395,1.38099499,1.38114797,1.38130611,1.38145433,1.38160327
,1.38174188,1.38187391,1.38202655,1.38217257,1.38232326,1.3824684
,1.38263211,1.38279891,1.38295734,1.38310711,1.38326585,1.3834401
,1.38362095,1.38379764,1.38397107,1.38412763,1.38431998,1.38450037
,1.38469238,1.38489345,1.3851029,1.38531472,1.38553168,1.38575968
,1.38598012,1.38619787,1.38640208,1.38662625,1.38683864,1.38707121
,1.3872939,1.3875455,1.38778616,1.3880341,1.38826873,1.38849983
,1.38873461,1.38895641,1.38919168,1.3894043,1.38963382,1.38986123
,1.390082,1.39028341,1.39050208,1.39071273,1.39092027,1.39113169
,1.39134528,1.39156393,1.39178309,1.39200801,1.39220985,1.39242645
,1.39260884,1.39281977,1.39302294,1.39321307,1.39340561,1.39357695
,1.39376159,1.39394309,1.39411082,1.39426538,1.3944344,1.39460665
,1.39477921,1.39494713,1.39510658,1.3952652,1.3954048,1.39554826
,1.39568217,1.39584735,1.39598068,1.39612557,1.39627292,1.39641309
,1.39653192,1.39666669,1.39678648,1.39689882,1.3969846,1.39705451
,1.3971223,1.39719042,1.39727774,1.39736695,1.39744298,1.39752261
,1.39763588,1.39773089,1.39781348,1.39788912,1.39799009,1.39806865
,1.39815724,1.39823522,1.39829948,1.39836018,1.39841314,1.39847414
,1.39852845,1.39859319,1.3986476,1.39872465,1.39880205,1.39890414
,1.39900719,1.39912085,1.39926947,1.39940799,1.39954535,1.39970443
,1.39986776,1.40002821,1.40019969,1.40035321,1.40050718,1.40065932
,1.40081867,1.40099465,1.40115691,1.40133357,1.4015097,1.4016765
,1.40182791,1.40199505,1.40216466,1.40234136,1.40252237,1.40271419
,1.40291816,1.40313443,1.40337529,1.40362635,1.40386694,1.40407094
,1.40427666,1.40449356,1.4047069,1.40491911,1.40513274,1.40535625
,1.40559323,1.40580461,1.40603559,1.40627495,1.40655069,1.40680889
,1.40708109,1.4073656,1.40763142,1.40791427,1.40819283,1.40846893
,1.40875044,1.40901409,1.40926747,1.40952433,1.40977053,1.4099759
,1.41017171,1.41036956,1.41055297,1.4107282,1.4108865,1.41106251
,1.41121768,1.4113814,1.41154385,1.41170276,1.41185266,1.41198306
,1.4121166,1.41224822,1.41238806,1.41253948,1.41268445,1.41283347
,1.41295832,1.41309591,1.41321882,1.41334101,1.41344716,1.41352969
,1.41361549,1.41370398,1.41381342,1.41391975,1.41402584,1.41412085
,1.41420577,1.414299,1.41440048,1.41447898,1.41458475,1.41466296
,1.41473655,1.41479564,1.41486829,1.41493496,1.41499021,1.41506533
,1.41512364,1.41517465,1.41521857,1.41524652,1.41526523,1.41529458
,1.41528771,1.41529935,1.41533899,1.41539848,1.41546852,1.41551799
,1.41559784,1.41567043,1.41574289,1.41581908,1.41588882,1.41594471
,1.41600622,1.41607401,1.41614852,1.41621101,1.41627103,1.41631754
,1.41636455,1.41641359,1.4164577,1.41649816,1.41651967,1.41653226
,1.41654568,1.41657085,1.41660662,1.41664652,1.41668522,1.41672443
,1.41677864,1.41683452,1.416895,1.41696123,1.41701121,1.41704251
,1.41707642,1.41711127,1.4171493,1.41718459,1.41720906,1.41722623
,1.41724788,1.41726642,1.41728192,1.41728962,1.41730864,1.4173417
,1.41738787,1.41744868,1.41750795,1.41758583,1.41764254,1.41770218
,1.41774498,1.41778473,1.41784848,1.41788204,1.41792539,1.41796557
,1.41803379,1.41810389,1.4181914,1.41828836,1.41838084,1.41846092
,1.41853874,1.41863445,1.41873194,1.41882416,1.41891917,1.41902915
,1.41913755,1.41925624,1.41939031,1.41952206,1.41965208,1.4197918
,1.41993374,1.42005933,1.42020163,1.42032074,1.42044277,1.42056554
,1.42069029,1.42082182,1.42097714,1.4211361,1.42130415,1.42148146
,1.42164873,1.4218315,1.42201491,1.42219025,1.42235998,1.42253955
,1.42274237,1.42293372,1.42312875,1.42332534,1.42351432,1.42369601
,1.42388005,1.42407657,1.42426445,1.42445205,1.4246327,1.42480803
,1.42500433,1.42518944,1.42536167,1.42550527,1.42565503,1.42580053
,1.42594279,1.42609618,1.4262646,1.42643585,1.42657879,1.42671001
,1.42684282,1.4269691,1.42708359,1.42722313,1.42737033,1.4275058
,1.42764507,1.42777048,1.42788677,1.42799539,1.42810527,1.42818975
,1.42829307,1.42839347,1.4284811,1.42856846,1.42865724,1.42872387
,1.4287826,1.42883965,1.42888466,1.42894748,1.42898871,1.42903559
,1.42909903,1.42917388,1.42923664,1.42928686,1.42934143,1.42938264
,1.42940512,1.42943195,1.4294709,1.429497,1.42952167,1.42953629
,1.42955407,1.42956223,1.42956187,1.42954278,1.42953134,1.42952713
,1.42953154,1.42954052,1.42953789,1.42950907,1.42947185,1.42942435
,1.42937381,1.42933313,1.42932675,1.42932948,1.42933326,1.42932329
,1.42927415,1.42921388,1.42914483,1.42907097,1.42900902,1.42893397
,1.4288543,1.42878196,1.42871727,1.42865186,1.42857894,1.42852569
,1.42845618,1.42838708,1.42832732,1.42825446,1.4281723,1.42808672
,1.42799747,1.42794566,1.4278703,1.42776917,1.42766307,1.4275554
,1.4274342,1.42730453,1.42719507,1.42712139,1.42705304,1.42697143
,1.42688861,1.42679196,1.42671022,1.42663108,1.42657951,1.42653113
,1.42649464,1.42645359,1.42640907,1.42636472,1.42630368,1.42626023
,1.42625306,1.42624789,1.42625688,1.4262785,1.42632888,1.42634953
,1.42636602,1.42638748,1.42643585,1.42651971,1.42661095,1.42671333
,1.42681937,1.42692976,1.42704405,1.42715643,1.42727808,1.42740176
,1.4275098,1.42761836,1.42769894,1.4277959,1.427884,1.42796235
,1.42806087,1.42815895,1.42826297,1.4283526,1.42839478,1.42845403
,1.42852546,1.4285977,1.42867589,1.42875844,1.42884342,1.42889283
,1.42891477,1.42891,1.42890865,1.42891301,1.42893905,1.4289382
,1.42894679,1.42892482,1.42890825,1.42886934,1.42883151,1.42880165
,1.42878472,1.428775,1.42874582,1.42869969,1.42863372,1.42855428
,1.42846386,1.42833941,1.42822568,1.42811015,1.42798628,1.4278458
,1.42767764,1.42750581,1.42733839,1.42716478,1.42697441,1.42679088
,1.42662048,1.42642404,1.42620984,1.42599398,1.42578524,1.42559858
,1.42541262,1.42524148,1.42508524,1.42492852,1.42477108,1.42461303
,1.42446212,1.42434827,1.42423033,1.42411618,1.42400134,1.42388613
,1.42379229,1.42370676,1.42365431,1.42358518,1.42353389,1.4234724
,1.42341486,1.42334056,1.42328638,1.42320732,1.42314215,1.42308193
,1.42306405,1.4230329,1.42300876,1.42295886,1.42290915,1.42287082
,1.42283766,1.42282807,1.42282195,1.42281487,1.42282209,1.42282655
,1.42281241,1.42279131,1.42277688,1.42277102,1.42275998,1.42274448
,1.42274812,1.42277989,1.42281253,1.42284132,1.42288627,1.42296215
,1.42306162,1.4231525,1.42324651,1.4233445,1.42344791,1.42355444
,1.42363985,1.42372082,1.42380635,1.42388666,1.42395069,1.42401297
,1.42406758,1.42410643,1.4241376,1.42414305,1.42412746,1.42408278
,1.42407565,1.42405323,1.42404191,1.42401056,1.42398864,1.42397477
,1.42398404,1.42398832,1.42397738,1.42393572,1.42391442,1.42388552
,1.42387485,1.42386979,1.42386425,1.42384152,1.42380256,1.42377646
,1.42374825,1.42371388,1.42366183,1.42363528,1.42363452,1.42364684
,1.42368312,1.42372683,1.42377991,1.42380638,1.42380307,1.42379033
,1.4237816,1.42376807,1.42373553,1.42368412,1.42363741,1.42357448
,1.4234978,1.42340395,1.42329283,1.42318781,1.4230897,1.4229806
,1.42288694,1.42279279,1.42271492,1.42263301,1.42257042,1.42252319
,1.42247834,1.42244537,1.42242945,1.4223909,1.42235667,1.42233669
,1.42234294,1.42233942,1.42232473,1.42228783,1.42224352,1.4221878
,1.42212322,1.42204785,1.42196343,1.42186768,1.42175693,1.42163553
,1.4215352,1.42145543,1.42133517,1.42121663,1.42110697,1.42101352
,1.42092282,1.4208031,1.42066004,1.42047192,1.42027876,1.4200651
,1.41987423,1.41969049,1.41950299,1.41930822,1.41912908,1.41895057
,1.41877268,1.41860426,1.41843299,1.41826759,1.41811684,1.41796088
,1.41783467,1.41771784,1.41762539,1.4175185,1.41741605,1.4173002
,1.41718431,1.41707587,1.41696557,1.41686567,1.41678349,1.41669639
,1.4166147,1.41655607,1.41648287,1.4164104,1.41635181,1.41628128
,1.41622874,1.41620357,1.41619313,1.41619418,1.41619544,1.41620414
,1.41620607,1.41622432,1.41624808,1.41626988,1.41627033,1.41630385
,1.41632707,1.41633779,1.41634556,1.41634252,1.41635745,1.41637555
,1.41642097,1.41646955,1.41652076,1.41655474,1.41659082,1.41664145
,1.41668878,1.41671653,1.41674068,1.41676965,1.41677358,1.41677765
,1.41678392,1.41676683,1.4167689,1.41672906,1.41666419,1.41656963
,1.41648684,1.41639964,1.41631002,1.41624442,1.41616142,1.4160611
,1.41596348,1.41583463,1.41570422,1.41557617,1.41541513,1.41524423
,1.41505524,1.41485004,1.41467505,1.41446942,1.41423797,1.41401562
,1.4137952,1.41357799,1.41336433,1.41315859,1.41295025,1.41274519
,1.4125178,1.41230042,1.41207304,1.41187589,1.4116633,1.41146215
,1.41123186,1.4109956,1.41076484,1.41052663,1.41026698,1.4100265
,1.40979166,1.40956427,1.40933189,1.40908863,1.40885681,1.40862617
,1.40839461,1.40819398,1.40800911,1.40781019,1.40763062,1.40743566
,1.4072635,1.40711851,1.40697061,1.40679776,1.40661882,1.40642789
,1.40622511,1.40601925,1.4058076,1.40557045,1.40535181,1.40514134
,1.40492739,1.40472996,1.4045314,1.40432599,1.4041089,1.40387597
,1.40365835,1.40345702,1.4032483,1.40302739,1.40279176,1.40254684
,1.40230213,1.40203384,1.40176886,1.40151622,1.40126133,1.40101624
,1.40074463,1.40050202,1.40024936,1.40002935,1.39982068,1.39960876
,1.39940893,1.39923452,1.39904446,1.39884699,1.3986412,1.39843244
,1.39824165,1.3980385,1.3978524,1.39765646,1.39741517,1.39716114
,1.39691307,1.39664223,1.39636821,1.39608807,1.39579112,1.39551071
,1.39526664,1.39503183,1.39481526,1.39459802,1.39438576,1.39418003
,1.39400497,1.39380652,1.39361808,1.39343276,1.39325148,1.39308079
,1.39292507,1.39279288,1.39264761,1.39252107,1.39237535,1.39222207
,1.39208224,1.39195896,1.39184196,1.3917251,1.39162996,1.39152252
,1.39141127,1.3913092,1.39119014,1.3910804,1.39096672,1.39085116
,1.39071825,1.39056097,1.39039278,1.39020583,1.39000902,1.38980289
,1.38960546,1.38941288,1.3892177,1.38901367,1.38881736,1.38859878
,1.38838667,1.38821632,1.3880425,1.38788348,1.38774717,1.38762575
,1.3874915,1.38735461,1.38720736,1.387032,1.38684531,1.3866512
,1.38644968,1.38624664,1.38606299,1.38588152,1.38573026,1.38555271
,1.38536035,1.38516372,1.38497239,1.38477049,1.3845624,1.38437686
,1.3841807,1.38399618,1.38382021,1.38363428,1.38343675,1.38323379
,1.38305563,1.38287921,1.38270951,1.38254319,1.38236625,1.38219415
,1.38200861,1.38180756,1.38161934,1.38144582,1.3812724,1.38110396
,1.38092937,1.38076211,1.38061373,1.38045933,1.38028824,1.38013185
,1.37998985,1.37984768,1.37971768,1.3795764,1.37940241,1.37923202
,1.37905424,1.37886424,1.3786807,1.378528,1.37839399,1.37827026
,1.37816017,1.37806756,1.37797776,1.3778857,1.37779166,1.37766728
,1.37752058,1.37736445,1.3772052,1.37705521,1.37689028,1.3766934
,1.37650194,1.37630297,1.37606583,1.37582043,1.37557109,1.37530286
,1.37503558,1.37476593,1.37449621,1.37417716,1.37384861,1.37351436
,1.37319067,1.37287387,1.3725533,1.37226084,1.37197764,1.37167932
,1.37137647,1.37108247,1.37080277,1.37053936,1.37025878,1.3699641
,1.36967602,1.36940361,1.36912525,1.36883398,1.36853395,1.36822939
,1.3679516,1.36769992,1.36745856,1.36720807,1.36695572,1.36668695
,1.36638956,1.36606761,1.36574078,1.3654079,1.36505977,1.36471572
,1.36438747,1.36407788,1.36378246,1.36350144,1.36321225,1.36294274
,1.36268688,1.36245749,1.36225926,1.36207236,1.36188513,1.36173043
,1.36157294,1.36141703,1.36128786,1.36118055,1.36107551,1.36097517
,1.36090089,1.36081878,1.36073483,1.3606236,1.36048966,1.36035966
,1.36020615,1.36006845,1.35993703,1.35979338,1.35966178,1.35951576
,1.35937493,1.35924704,1.35911995,1.35897942,1.35883691,1.35867838
,1.35850672,1.35833969,1.35816216,1.35796849,1.35777711,1.35758336
,1.35740482,1.35724285,1.35709527,1.35695004,1.35680783,1.35666986
,1.3565336,1.35641116,1.35627233,1.35610298,1.35591651,1.35573638
,1.35553657,1.35533328,1.35512932,1.35491669,1.35468096,1.35444555
,1.35419411,1.35394331,1.35369805,1.35345678,1.35320619,1.3529365
,1.35263617,1.35233668,1.35203741,1.35172481,1.35142027,1.35113329
,1.35086543,1.35062109,1.35037324,1.35013364,1.34986072,1.34958607
,1.34931489,1.34903439,1.34873704,1.34842265,1.3481025,1.34778254
,1.34747406,1.34716674,1.34686832,1.34658872,1.34632657,1.34607779
,1.34582163,1.34554108,1.34524306,1.34492125,1.34459348,1.34423117
,1.34388382,1.34354259,1.34318675,1.34281208,1.3424126,1.34202705
,1.3416553,1.34128673,1.34090656,1.34055191,1.34021434,1.33987525
,1.33951443,1.33916693,1.33880453,1.33844047,1.33808081,1.33770331
,1.33732426,1.33696545,1.33661179,1.33626361,1.33591734,1.33556734
,1.33524812,1.33494603,1.33463839,1.3343181,1.33398881,1.33367567
,1.33335563,1.33304899,1.33273808,1.33242796,1.33210013,1.33180958
,1.33151394,1.33122872,1.33093943,1.33065673,1.33035524,1.33004472
,1.3297288,1.3293843,1.32903323,1.32868873,1.32836268,1.3280399
,1.32774445,1.32743891,1.32716418,1.32687947,1.3266062,1.32634685
,1.32611881,1.32590213,1.32566853,1.32543883,1.32519819,1.32495086
,1.32469271,1.32441458,1.32412376,1.32383537,1.32354938,1.32325564
,1.322966,1.32267115,1.32237582,1.3221045,1.3217906,1.3214587
,1.32114086,1.32084157,1.32052482,1.32019432,1.31982442,1.31945434
,1.31908818,1.31872386,1.31833728,1.31795828,1.31760252,1.31724727
,1.3169127,1.31661117,1.31628785,1.31599721,1.31569746,1.31540531
,1.31509009,1.31479464,1.31450497,1.31421511,1.31393664,1.31365091
,1.31338126,1.3131093,1.31284713,1.31257414,1.31228523,1.31199581
,1.31170309,1.31139349,1.31107346,1.31074175,1.31041803,1.3101112
,1.3098045,1.30949596,1.30921266,1.30892343,1.30864266,1.30836477
,1.30812185,1.3078736,1.30764529,1.30741816,1.3071909,1.30696596
,1.30670218,1.30647195,1.3062886,1.30610945,1.30591042,1.30573381
,1.30553619,1.30535664,1.30516194,1.30497902,1.30479829,1.30462261
,1.30444668,1.30424513,1.30404944,1.30383929,1.30360603,1.30338593
,1.30313045,1.30288623,1.30263345,1.30240127,1.30215271,1.30190745
,1.30165157,1.30139543,1.30116536,1.30089788,1.30063728,1.30036767
,1.3001046,1.29988,1.29964981,1.29944225,1.29924013,1.29903092
,1.29880602,1.29858092,1.2983448,1.29811455,1.29789054,1.29764402
,1.29740132,1.29715912,1.29692118,1.29664895,1.29637138,1.2960817
,1.29577795,1.29547284,1.29517889,1.29489986,1.29462457,1.29430438
,1.29396552,1.29361702,1.29327077,1.29294349,1.29262305,1.29231719
,1.29200614,1.29168125,1.29136124,1.29102592,1.29069649,1.29035274
,1.28999162,1.28963807,1.28926037,1.28890764,1.28854705,1.28820227
,1.28784713,1.28751967,1.28719872,1.28690415,1.2866066,1.28629006
,1.28601848,1.28572249,1.28543005,1.28510748,1.28475709,1.28438876
,1.28398485,1.28357719,1.28318939,1.2828233,1.28245934,1.28211364
,1.28175401,1.28139919,1.28106009,1.28071023,1.28035903,1.28001512
,1.27967789,1.27932184,1.27898561,1.27865563,1.27831678,1.27795534
,1.27760459,1.27721874,1.27684178,1.27645348,1.2760694,1.27566586
,1.27525543,1.27483234,1.27441339,1.27400031,1.27360901,1.27320762
,1.27282402,1.27243239,1.27205699,1.2716944,1.27131413,1.27095382
,1.27058267,1.27020727,1.26981053,1.26941304,1.26900989,1.2686058
,1.26817245,1.26776286,1.26735457,1.26691725,1.26649105,1.26606562
,1.26567801,1.26530349,1.26496222,1.26463865,1.26431682,1.26398987
,1.26365699,1.2633145,1.26296409,1.26261754,1.26227917,1.26194363
,1.26161433,1.26131328,1.26099023,1.260689,1.26041533,1.26011216
,1.25981509,1.25952337,1.25925108,1.25894847,1.25868732,1.25843673
,1.25821978,1.25803096,1.2578675,1.25770806,1.25755582,1.25738111
,1.25719775,1.25700102,1.25681674,1.25663336,1.25645758,1.25628312
,1.25610865,1.25594336,1.25577724,1.2555899,1.25540439,1.25524283
,1.25509815,1.25493622,1.25477089,1.25462371,1.2544403,1.25424385
,1.2540678,1.25388545,1.25369816,1.25349166,1.25328528,1.25302539
,1.25275748,1.25249328,1.25222386,1.25193144,1.2516438,1.25135556
,1.2510804,1.25079117,1.25050296,1.25023107,1.24992812,1.24964498
,1.24934759,1.2490411,1.24875056,1.24846701,1.24819857,1.24792932
,1.24769549,1.24744841,1.24719508,1.24691085,1.24660021,1.2462635
,1.24594077,1.24563139,1.24532904,1.24504028,1.24475681,1.24448481
,1.24420479,1.24392434,1.24362439,1.24330998,1.24299541,1.24266916
,1.24236728,1.24206381,1.24174637,1.24138312,1.24102662,1.24066295
,1.24030615,1.23997597,1.23964813,1.23929819,1.23894762,1.23860368
,1.23825656,1.23790883,1.23761938,1.23733181,1.23704135,1.2367453
,1.23648389,1.23621643,1.23594856,1.23566864,1.23539292,1.23509218
,1.2347805,1.23445856,1.23412854,1.23378857,1.23344487,1.2331082
,1.23277301,1.23242105,1.23205625,1.23165944,1.23123815,1.23080619
,1.23040278,1.23001272,1.22962698,1.22922308,1.22880066,1.22838157
,1.2279581,1.22751099,1.22705632,1.22659672,1.22611899,1.22564435])
# %%
freqfilter =  ["030", "143", "545","857"]
import component_separation.preprocess as prep
PLANCKMAPFREQ = np.array([p.value for p in list(Planckf)])
PLANCKMAPFREQfiltered = np.array([p.value for p in list(Planckf) if p.value not in freqfilter])
elaw = np.array([prep.tcmb2trj_sc(FREQ) for FREQ in PLANCKMAPFREQ if FREQ not in freqfilter])

elaw[PLANCKMAPFREQfiltered>="100"]
# %%
freqdset = cf['pa']['freqdset'] # DX12 or NERSC
hitsvar = io.load_hitsvar(cf["pa"], 3, "/mnt/c/Users/sebas/OneDrive/Desktop/Uni/project/component_separation/")
0

# %%
print(np.min(hitsvar["143"]))
#%%
# build
tresh_low, tresh_up = 0.05, 1.0
masks = msk.hitsvar2mask(hitsvar, tresh_low, tresh_up)

# %%
# hitsmask = np.load('/mnt/c/Users/sebas/OneDrive/Desktop/Uni/project/component_separation/data/tmp/mask/hitsvar/DX12-freq_143-0.0to0.5-split_Full.hitshist.npy')
mean = np.mean(masks["143"])
std = np.std(masks["143"])
print(len(masks["143"][masks["143"]==True]))
# hp.mollview(hitsmask, norm= 'hist')
# hp.mollview(np.where(np.abs(hitsmask)>mean+20*std, 0.0, hitsmask))
hp.mollview(masks["143"])


# %%
print("K_CMB to K_RJ conversion factors")
print()
print("Instrument  Factor")
print(30*"-")
for channel in Planckf:
    print("{}         {}".format(channel.value, slhpastro.convfact(freq=int(channel.value)*1e9, fr=r'K_CMB',to=r'K_RJ')))


# %%
mean = np.mean(hitsvar["143"])
std = np.std(hitsvar["143"])
print(mean, std)
plt.hist(np.where(np.abs(hitsvar["143"])>mean+20*std, 0.0, hitsvar["143"]), bins = 100, alpha=0.5)
# plt.plot(mean+40*std, 1e8, lw=5, color="red")
plt.yscale('log')
plt.show()


# %%
plt.plot(np.sqrt(hdul[28].data.field(0)))
plt.plot(np.sqrt(hdul[29].data.field(0)))
plt.plot(np.sqrt(hdul[30].data.field(0)))
plt.plot(np.sqrt(np.sqrt(hdul[28].data.field(0))*np.sqrt(hdul[29].data.field(0))))
plt.grid()


hdul = fits.open("/mnt/c/Users/sebas/OneDrive/Desktop/Uni/project/component_separation/data/map/frequency/HFI_SkyMap_100-field_2048_R3.01_full.fits")
hitsmap = hp.read_map("/mnt/c/Users/sebas/OneDrive/Desktop/Uni/project/component_separation/data/map/frequency/HFI_SkyMap_143-field_2048_R3.01_full.fits", field=4)

# %%
hdul[1].header
# %%
hdul = fits.open(
    "/mnt/c/Users/sebas/OneDrive/Desktop/Uni/project/component_separation/data/map/frequency/LFI_SkyMap_030-field_1024_R3.00_full.fits")

# %% Pixelisation
hdul[1].header
# %%
from pylab import *
import numpy
import re

Jansky2SI=1.0e-26
SI2Jansky=1.0e+26
speedOfLight=2.99792458e8
kBoltzmann=1.380658e-23
sigmaStefanBoltzmann=5.67051e-8
hPlanck=6.6260755e-34
astronomicalUnit=1.49597893e11
solarConstant=1368.0
tropicalYear=3.15569259747e7
tcmb = 2.726
prefixes = {'n':1e-9,'u':1e-6,'m':1e-3,'k':1e3,'M':1e6,'G':1e9}

def K_CMB(freq):
    """ Return conversion factor from Kelvin CMB to SI at a given frequency.
    
    Parameters
    ----------
    freq : scalar. Frequency value. 

    Returns
    -------
    scalar, conversion factor value. 
    """
    x = (hPlanck *freq)/ (kBoltzmann * tcmb)
    ex = exp(x)
    den = ex-1
    den *= den
    den = 1/den
    fc = freq /speedOfLight 
    return 2*kBoltzmann * fc *fc * x * x * ex * den

def K_RJ(freq):
    """ Return conversion factor from Kelvin Raleigh Jeans to SI at a given frequency.

    Parameters
    ----------
    freq : scalar. Frequency value. 

    Returns
    -------
    scalar, conversion factor value. 
    """
    return 2*kBoltzmann*freq*freq/(speedOfLight*speedOfLight)


def convfact(freq=1.0e10, fr=r'mK_CMB',to=r'mK_CMB'):
    """ Compute the conversion factor between two units at a given frequency in GHz.

    Parameters
    ----------
    freq : scalar. Frequency value. 
    fr : string as prefixunit. unit can be either 'Jy/sr', 'K_CMB', 'K_RJ', 'K/KCMB', 'y_sz', 'si', 'taubeta'
    with optionnal prefix 'n', 'u', 'm', 'k', 'M', 'G' 
    to : string as prefixunit. 

    Returns
    -------
    scalar, conversion factor value. 
    """

    frpre, fru =  re.match(r'(n|u|m|k|M|G)?(Jy/sr|K_CMB|K_RJ|K/KCMB|y_sz|si|taubeta2)', fr).groups()
    topre, tou = re.match(r'(n|u|m|k|M|G)?(Jy/sr|K_CMB|K_RJ|K/KCMB|y_sz|si|taubeta2)', to).groups()

    if fru == 'Jy/sr':
        fru = 'Jy'
    if tou == 'Jy/sr':
        tou = 'Jy'
    if fru == tou:
        fac = 1.0
    else:
        fac = eval(fru+'(freq)/'+tou+'(freq)')
    
    if not frpre is None:
        fac *= prefixes[frpre]
    if not topre is None:
        fac /= prefixes[topre]

    return fac
for freq in ["030", "044", "070", "100", "143", "217","353"]:
    print(freq, ": ",  convfact(int(freq)*1e9, fr="K_CMB", to="K_RJ"))
# %%
